---
这个有空再好好总结一下，先大概就是这些
---

# 文件上传

## 0x00 基于解析漏洞之类的常规上传

###  1. 00截断

1. 在url中加入%00，如[http://xxxxxx/aa.php%00.jpg](http://xxxx/shell.php%00.jpg)
2. 在burpsuite的16进制编辑工具将”aa.php .jpg”php后面的的空格由20改成00 ，有时候把jpg前面的点由2e改成00也可以

这个应该是一种编码转换产生的漏洞，看过一个大佬用php iconv\(\)转码函数验证过，当由utf8转gbk的时候就会产生这种漏洞，后面的文件后缀就会被截断掉，文件当成前面的解析

### 2.服务器解析方面的

解析漏洞一般可以用来绕过上传，或者是连接一些图片木马之类的

#### apache解析漏洞

比如a.php.jds.jfv apache会从jfv开始解析，因为jfv不是一个可以解析的文件后缀解析不了，然后apache就会往前推进解析jds，jds也不是可以解析的后缀，最后这个文件就会被解析成a.php，大概在apache2.2左右会产生这个漏洞

#### IIS解析漏洞

- 比较经典的就是IIS6的文件夹改成aa.asp形式的时候，这个文件夹下的文件会全部当作asp处理
- 还有就是配合php-cgi产生的11.jpg/11.php 11.php不存在 但是会吧11.jpg当成php解析
- 不常用的扩展名

#### Nginx解析漏洞

就是一种截断，截断的话的和上传截断又有点不同是在文件名后面截断：a.jpg%00.php ，这样本来是一张图片就会被解析成php,nginx0.5到0.8之间会出现这个漏洞

#### php-cgi

这个就是文件名/文件名.php，出现在iis和nginx上cgi.fix\_pathinfo=1（默认就是这样）时产生的漏洞

## 0x01 校验产生的漏洞

### 1.文件类型

抓包改content-type字段，一般图片是: image/gif,上传php文件是app……

这时候改成image/gif就可以绕过，产生原因就是通过 $\_FILES只对type判断是否合法

### 2.文件头

这个就是直接判断文件头是否符合要求，符合的话就直接绕过了 比如文件内容是这种 `GIF89a<?php phpinfo(); ?>`就会被当作合法文件处理

还有一些关于大小写绕过，Windows命名规则绕过，函数还有函数编辑器之类的绕过

## 0x02 .htaccess重写解析规则

这个应该是只有apache才会产生这个漏洞，上传一个名字为.htaccess的文件内容是 `AddType application/x-httpd-php .jpg`成功覆盖掉原有的.htaccess文件的话就会把所有jpg文件当成php文件解析

## 总结：

其实上传漏洞还有很多 ，php3、php5、php7之类文件名。还有基于编辑器的，还有抓包双文件名的，等等 遇到在总结

